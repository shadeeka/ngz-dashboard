!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("@angular/core")):"function"==typeof define&&define.amd?define(["@angular/core"],t):"object"==typeof exports?exports["ngx-dashboard.umd.min"]=t(require("@angular/core")):e["ngx-dashboard.umd.min"]=t(e["@angular/core"])}(this,function(e){return function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=7)}([function(t,n){t.exports=e},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(2),a=n(6),l=n(3),c=function(){function e(e,t,n){this.injector=e,this._ngEl=t,this._renderer=n,this.size=[1,1],this.onSizeChanged=new r.EventEmitter}return Object.defineProperty(e.prototype,"conf",{set:function(e){e&&(this._conf=e,this.setup())},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this._renderer.addClass(this._ngEl.nativeElement,"widget")},e.prototype.setup=function(){if(this._conf.hasOwnProperty("data_model_type")){console.log(this._conf.data_model_type);var e=this.injector.get(this._conf.data_model_type);console.log(e),e&&(this._dataProvider=e,this._dataProvider.setup(),this._dataProvider.init())}},e.prototype.setSize=function(e){this.size=e,this.onSizeChanged.emit(this.size)},Object.defineProperty(e.prototype,"element",{get:function(){return this._ngEl.nativeElement},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offset",{get:function(){return this._ngEl.nativeElement.getBoundingClientRect()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._ngEl.nativeElement.offsetWidth},set:function(e){this._renderer.setStyle(this._ngEl.nativeElement,"width",e+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._ngEl.nativeElement.offsetHeight},set:function(e){this._renderer.setStyle(this._ngEl.nativeElement,"height",e+"px")},enumerable:!0,configurable:!0}),e.prototype.setPosition=function(e,t){this._renderer.setStyle(this._ngEl.nativeElement,"top",e+"px"),this._renderer.setStyle(this._ngEl.nativeElement,"left",t+"px")},e.prototype.setEventListener=function(e){var t=this;this._handle?(this._renderer.listen(this._handle.element,"mousedown",function(n){return e(n,t)}),this._renderer.listen(this._handle.element,"touchstart",function(n){return e(n,t)})):(this._renderer.listen(this._ngEl.nativeElement,"mousedown",function(n){return e(n,t)}),this._renderer.listen(this._ngEl.nativeElement,"touchstart",function(n){return e(n,t)}))},e.prototype.addClass=function(e){this._renderer.addClass(this._ngEl.nativeElement,e)},e.prototype.removeClass=function(e){this._renderer.removeClass(this._ngEl.nativeElement,e)},Object.defineProperty(e.prototype,"handle",{get:function(){return this._handle?this._handle.element:this.element},enumerable:!0,configurable:!0}),e.prototype.removeFromParent=function(){this._ngEl.nativeElement.remove()},e.prototype.ngOnDestroy=function(){this._dataProvider&&this._dataProvider.destroy()},i([r.Input(),o("design:type",Array)],e.prototype,"size",void 0),i([r.Input(),o("design:type",String)],e.prototype,"widgetId",void 0),i([r.Input(),o("design:type",a.WidgetDefinition),o("design:paramtypes",[a.WidgetDefinition])],e.prototype,"conf",null),i([r.Output(),o("design:type",r.EventEmitter)],e.prototype,"onSizeChanged",void 0),i([r.ContentChild(s.WidgetHandleDirective),o("design:type",s.WidgetHandleDirective)],e.prototype,"_handle",void 0),e=i([r.Component({selector:"widget",template:"<ng-content></ng-content>"}),o("design:paramtypes",[l.ServiceLocator,r.ElementRef,r.Renderer2])],e)}();t.WidgetComponent=c},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=function(){function e(e){this._ngEl=e}return Object.defineProperty(e.prototype,"element",{get:function(){return this._ngEl.nativeElement},enumerable:!0,configurable:!0}),e=i([r.Directive({selector:"[widgetHandle]",exportAs:"widgetHandle"}),o("design:paramtypes",[r.ElementRef])],e)}();t.WidgetHandleDirective=s},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),r=n(4),s=function(){function e(){}return e.prototype.get=function(e){return new r.DataModelService},e=i([o.Injectable()],e)}();t.ServiceLocator=s},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=function(){function e(){}return e.prototype.setup=function(){console.log("data model setup")},e.prototype.init=function(){console.log("data model init")},e.prototype.update=function(){console.log("data model update")},e.prototype.destroy=function(){console.log("data model destroy")},e=i([r.Injectable(),o("design:paramtypes",[])],e)}();t.DataModelService=s},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(1),a=function(){function e(e,t,n){this._componentFactoryResolver=e,this._ngEl=t,this._renderer=n,this.onDragStart=new r.EventEmitter,this.onDrag=new r.EventEmitter,this.onDragEnd=new r.EventEmitter,this.onOrderChange=new r.EventEmitter,this.margin=10,this.widgetsSize=[150,150],this.THRESHOLD=10,this.dragEnable=!0,this._width=0,this._nbColumn=0,this._previousPosition={top:0,left:0},this._isDragging=!1,this._lastOrder=[],this._elements=[],this._scrollChange=0,this._isScrolling=!1}return t=e,Object.defineProperty(e.prototype,"width",{get:function(){return this._ngEl.nativeElement.offsetWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._ngEl.nativeElement.offsetHeight},enumerable:!0,configurable:!0}),e.prototype.ngOnChanges=function(e){this._calculSizeAndColumn(),this._calculPositions()},e.prototype.ngAfterViewInit=function(){var e=this;this._items.forEach(function(t){t.setEventListener(e._onMouseDown.bind(e)),e._elements.push({instance:t,componentType:null,location:null,injector:null,hostView:null,destroy:null,onDestroy:null,changeDetectorRef:null})}),this._calculSizeAndColumn(),this._offset={top:this._ngEl.nativeElement.offsetY||this._ngEl.nativeElement.offsetTop,left:this._ngEl.nativeElement.offsetX||this._ngEl.nativeElement.offsetLeft},this._calculPositions()},e.prototype.refreshWidgets=function(){this._calculPositions()},e.prototype.enableDrag=function(){this.dragEnable=!0,this._renderer.removeClass(this._ngEl.nativeElement,"disabled")},e.prototype.disableDrag=function(){this.dragEnable=!1,this._renderer.addClass(this._ngEl.nativeElement,"disabled")},e.prototype.addItem=function(e){var t=this,n=this._componentFactoryResolver.resolveComponentFactory(e),i=this._viewCntRef.createComponent(n),o=i.instance;return o.setEventListener(this._onMouseDown.bind(this)),o.onSizeChanged.subscribe(function(){return t._calculPositions()}),this._elements.push(i),this._calculPositions(),o},e.prototype.clearItems=function(){this._viewCntRef.clear(),this._elements=[]},e.prototype.getWidgetById=function(e){for(var t,n=0;n<this._elements.length&&(t=this._elements[n].instance,e!=t.widgetId);n++);return t},e.prototype.removeItem=function(e){for(var t,n=0;n<this._elements.length&&(t=this._elements[n],t.instance.widgetId!=e.widgetId);n++);this._removeElement(t)},e.prototype.removeItemByIndex=function(e){for(var t,n=0;n<this._elements.length;n++){var i=this._elements[n];if(n===e){t=i;break}}t&&this._removeElement(t)},e.prototype.removeItemById=function(e){for(var t,n=0;n<this._elements.length;n++){var i=this._elements[n];if(i.instance.widgetId==e){t=i;break}}t&&this._removeElement(t)},e.prototype._removeElement=function(e){if(e){this._enableAnimation();var t=null==e.hostView?-1:this._viewCntRef.indexOf(e.hostView);-1==t?e.instance.removeFromParent():this._viewCntRef.remove(t),this._elements=this._elements.filter(function(t,n){return t!==e}),this._calculPositions(),this._disableAnimation()}},e.prototype._calculPositions=function(){for(var e=[],t=0;t<this._nbColumn;t++)e[t]=0;this._positionWidget(e,this._elements,0,0,0)},e.prototype._positionWidget=function(e,t,n,i,o){if(t[n]){var r=t[n].instance,s=r.size[0];s>this._nbColumn&&(s=this._nbColumn),r.width=this.widgetsSize[0]*s+(s-1)*this.margin,r.height=this.widgetsSize[1]*r.size[1]+(r.size[1]-1)*this.margin;for(var a=i+s-1<=this._nbColumn;e[i]>0||!a;){if(i++,a=i+s-1<=this._nbColumn,i>=this._nbColumn){i=0;for(var l=0;l<e.length;l++)e[l]--;o++,a=i+s-1<=this._nbColumn}if(a)for(var l=1;l<s&&(a=e[i+l]<=0);l++);}var c=i*this.widgetsSize[0]+i*this.margin+this.margin/2,u=o*this.widgetsSize[1]+o*this.margin+this.margin/2;e[i]=r.size[1];for(var l=1;l<s;l++)e[i+l]=r.size[1];r.setPosition(u,c),this._positionWidget(e,t,n+1,i,o)}else{for(var h=0,l=0;l<e.length;l++)h<e[l]&&(h=e[l]),e[l]--;if(h>0)this._positionWidget(e,t,n,i,o+1);else{var f=o*this.widgetsSize[1]+o*this.margin;this._renderer.setStyle(this._ngEl.nativeElement,"height",f+"px")}}},e.prototype._calculSizeAndColumn=function(){this._width=this._ngEl.nativeElement.offsetWidth,this._nbColumn=Math.floor(this._width/(this.widgetsSize[0]+this.margin))},e.prototype._onResize=function(e){this._calculSizeAndColumn(),this._calculPositions()},e.prototype._onMouseDown=function(e,t){return this._isDragging=this.dragEnable&&e.target===t.handle,this._isDragging&&(this.onDragStart.emit({widget:t,event:e}),t.addClass("active"),this._currentElement=t,this._offset=this._getOffsetFromTarget(e),this._enableAnimation(),this._lastOrder=this.order,this._isTouchEvent(e)&&(e.preventDefault(),e.stopPropagation()),this._currentMouseEvent=e),!0},Object.defineProperty(e.prototype,"order",{get:function(){return this._elements.map(function(e){return e.instance.widgetId})},enumerable:!0,configurable:!0}),e.prototype._onMouseMove=function(e){if(this._isDragging){this._isTouchEvent(e)&&(e=e.touches.length>0?e.touches[0]:e.changedTouches[0]);var t=e.clientY,n=t,i=document.body,o=i.offsetTop;window.innerHeight-n<80?(this._isScrolling=!0,this._scrollDown(i,n,e)):o+n<80?(this._isScrolling=!0,this._scrollUp(i,n,e)):this._isScrolling=!1,this.onDrag.emit({widget:this._currentElement,event:e});var r=this._getMousePosition(e),s=r.left-this._offset.left,a=r.top-this._offset.top;(Math.abs(r.top-this._previousPosition.top)>this.THRESHOLD||Math.abs(r.left-this._previousPosition.left)>this.THRESHOLD)&&(this._elements.sort(this._compare),this._calculPositions(),this._previousPosition=r),this._currentElement.setPosition(a,s),this._isTouchEvent(e)&&(e.preventDefault(),e.stopPropagation()),this._currentMouseEvent=e}return!0},e.prototype._scrollDown=function(e,n,i){return this._isDragging&&e.scrollTop<this._ngEl.nativeElement.offsetHeight-window.innerHeight+this._currentElement.height&&this._isScrolling&&(e.scrollTop+=t.SCROLL_STEP,this._scrollChange=t.SCROLL_STEP,setTimeout(this._scrollDown.bind(this,e,n,i),t.SCROLL_DELAY)),!0},e.prototype._scrollUp=function(e,n,i){return this._isDragging&&0!=e.scrollTop&&this._isScrolling&&(e.scrollTop-=t.SCROLL_STEP,this._scrollChange=-t.SCROLL_STEP,setTimeout(this._scrollUp.bind(this,e,n,i),t.SCROLL_DELAY)),!0},e.prototype._onScroll=function(e){if(this._isDragging){var t,n=this._ngEl.nativeElement.getBoundingClientRect(),i=void 0;i=this._currentMouseEvent.clientX-n.left,t=this._currentMouseEvent.clientY-n.top,this.onDrag.emit({widget:this._currentElement,event:e}),i-=this._offset.left;var o=t-this._offset.top+this._scrollChange;(Math.abs(t-this._previousPosition.top)>this.THRESHOLD||Math.abs(i-this._previousPosition.left)>this.THRESHOLD)&&(this._elements.sort(this._compare),this._calculPositions()),this._currentElement.setPosition(o,i)}return!0},e.prototype._onMouseUp=function(e){if(this._isDragging){this._isDragging=!1,this._isScrolling=!1,this._currentElement&&(this.onDragEnd.emit({widget:this._currentElement,event:e}),this._currentElement.removeClass("active"),this._currentElement.addClass("animate")),this._currentElement=null,this._offset=null,this._calculPositions(),this._disableAnimation(),this._isTouchEvent(e)&&(e.preventDefault(),e.stopPropagation());var t=this.order;JSON.stringify(this._lastOrder)!=JSON.stringify(t)&&this.onOrderChange.emit(this.order)}return!0},e.prototype._manageEvent=function(e){return this._isTouchEvent(e)&&(e=e.touches.length>0?e.touches[0]:e.changedTouches[0]),e},e.prototype._isTouchEvent=function(e){return window.TouchEvent&&e instanceof TouchEvent||e.touches||e.changedTouches},e.prototype._getOffsetFromTarget=function(e){var t,n,i=0;if(this._isTouchEvent(e)){e=e.touches.length>0?e.touches[0]:e.changedTouches[0];var o=e.target.getBoundingClientRect();t=e.pageX-o.left,n=e.pageY-o.top,i=document.body.scrollTop}else t=e.offsetX||e.offsetLeft,n=e.offsetY||e.offsetTop;return{top:n-i,left:t}},e.prototype._getMousePosition=function(e){e=this._manageEvent(e);var t=this._ngEl.nativeElement.getBoundingClientRect();return{left:e.clientX-t.left,top:e.clientY-t.top}},e.prototype._compare=function(e,t){return e.instance.offset.top>t.instance.offset.top+t.instance.height/2?1:t.instance.offset.top>e.instance.offset.top+e.instance.height/2?-1:e.instance.offset.left+e.instance.width/2>t.instance.offset.left+t.instance.width/2?1:t.instance.offset.left+t.instance.width/2>e.instance.offset.left+e.instance.width/2?-1:0},e.prototype._enableAnimation=function(){var e=this;this._elements.forEach(function(t){t.instance!=e._currentElement&&t.instance.addClass("animate")})},e.prototype._disableAnimation=function(){var e=this;setTimeout(function(){e._elements.forEach(function(e){e.instance.removeClass("animate")})},400)},e.SCROLL_STEP=15,e.SCROLL_DELAY=100,i([r.Output(),o("design:type",r.EventEmitter)],e.prototype,"onDragStart",void 0),i([r.Output(),o("design:type",r.EventEmitter)],e.prototype,"onDrag",void 0),i([r.Output(),o("design:type",r.EventEmitter)],e.prototype,"onDragEnd",void 0),i([r.Output(),o("design:type",r.EventEmitter)],e.prototype,"onOrderChange",void 0),i([r.Input(),o("design:type",Number)],e.prototype,"margin",void 0),i([r.Input(),o("design:type",Array)],e.prototype,"widgetsSize",void 0),i([r.Input(),o("design:type",Number)],e.prototype,"THRESHOLD",void 0),i([r.ViewChild("target",{read:r.ViewContainerRef}),o("design:type",r.ViewContainerRef)],e.prototype,"_viewCntRef",void 0),i([r.ContentChildren(s.WidgetComponent),o("design:type",r.QueryList)],e.prototype,"_items",void 0),e=t=i([r.Component({selector:"dashboard",template:"<div #target><ng-content></ng-content></div>",host:{"(window:resize)":"_onResize($event)","(document:mousemove)":"_onMouseMove($event)","(document:mouseup)":"_onMouseUp($event)","(document:touchmove)":"_onMouseMove($event)","(document:touchend)":"_onMouseUp($event)","(document:touchcancel)":"_onMouseUp($event)","(document:scroll)":"_onScroll($event)"},styles:["\n    :host {\n      position: relative;\n      display: block;\n    }\n\n    :host /deep/ .widget {\n      position: absolute;\n      top: 0;\n      left: 0;\n      -webkit-touch-callout: none; /* iOS Safari */\n      -webkit-user-select: none; /* Chrome/Safari/Opera */\n      -khtml-user-select: none; /* Konqueror */\n      -moz-user-select: none; /* Firefox */\n      -ms-user-select: none; /* Internet Explorer/Edge */\n      user-select: none;\n      /* Non-prefixed version, currently\n                             not supported by any browser */\n    }\n\n    :host /deep/ .widget.animate {\n      -webkit-transition: all 300ms ease-out;\n      -moz-transition: all 300ms ease-out;\n      -o-transition: all 300ms ease-out;\n      transition: all 300ms ease-out;\n    }\n\n    :host /deep/ .widget.active {\n      z-index: 100000;\n    }"]}),o("design:paramtypes",[r.ComponentFactoryResolver,r.ElementRef,r.Renderer2])],e);var t}();t.DashboardComponent=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.args={},this.name=e&&e.name,this.data_attribute_name=e&&e.data_attribute_name,this.data_model_type=e&&e.data_model_type,this.args=e&&e.args}return e}();t.WidgetDefinition=i},function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),i(n(8)),i(n(1)),i(n(5)),i(n(2)),i(n(4)),i(n(6)),i(n(3)),i(n(9))},function(e,t,n){"use strict";var i=this&&this.__decorate||function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),r=n(5),s=n(1),a=n(2),l=n(4),c=n(3),u=function(){function e(){}return e=i([o.NgModule({declarations:[r.DashboardComponent,s.WidgetComponent,a.WidgetHandleDirective],exports:[r.DashboardComponent,s.WidgetComponent,a.WidgetHandleDirective],providers:[l.DataModelService,c.ServiceLocator]})],e)}();t.NgDashboardModule=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REGISTRY=new Map}])});